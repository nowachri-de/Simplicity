<!DOCTYPE html>
<html lang="en" >

	<head>
	  <meta charset="UTF-8">
	  <title>MatMul GPU</title>
	  <script src="js/glfunctions.js"></script>
	  <script src="js/shader.js"></script>
	  <script src="js/program.js"></script>
	   <script src="js/resultreader.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/5.4.2/math.min.js"></script>
	  
	</head>

	<body>
		<canvas id="canvas"></canvas>
		
		<script>
		    //Create two matrices 
			var matrixA  = new Matrix(256,256);
			var matrixB  = new Matrix(256,256);
			
			//Do random initialization
			matrixA.randomInitialize();
			matrixB.randomInitialize();
			
			//console.log("Matrix A");
			//matrixA.print(5);
			
			//console.log("Matrix B");
			//matrixB.print(5);
			
			var program  = new Program("canvas");
			var outputDimensions = program.getOutputDimensions(matrixA,matrixB);
			
			var textureFactory = new TextureFactory("canvas");
			
			var textureA = textureFactory.createTexture('textureA',matrixA,'R');
			var textureB = textureFactory.createTexture('textureB',matrixB,'R');
			var textureC = textureFactory.createResultTexture('textureC',outputDimensions);
			var textureD = textureFactory.createReadableTexture('textureD',outputDimensions);
			
			var shader =  new Shader(program.gl);

			program.buildProgram(shader.getVertexShader(shader.getVertexShaderCode()),shader.getFragmentShader(shader.getFragmentShaderCode()));
			console.log(outputDimensions);
			
			var t0 = performance.now();
			program.compute(textureA,textureB,textureC,outputDimensions); 
			var t1 = performance.now();
			console.log("GPU time for matmul of 256 * 256 " + (t1 - t0) + " milliseconds.")
			
			
			
			
			/*
				Compare the result of the GPU matrix multiplication
				With the result of a matrix multiplication on CPU
			*/
			var mat1 = math.matrix(matrixA.as2DArray());
			var mat2 = math.matrix(matrixB.as2DArray());
			
			t0 = performance.now();
			var result2 = math.multiply(mat1,mat2);
			t1 = performance.now();
			console.log("JS time for matmul of 256 * 256 " + (t1 - t0) + " milliseconds.")
			
			
			
		</script>
		
	</body>
</html>
